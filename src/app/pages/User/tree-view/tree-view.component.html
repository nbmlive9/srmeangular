<div class="card shadow-sm border-0 p-4" style="border-radius: 12px;">

  <!-- Header / Genealogy Tag -->
  <div class="row align-items-center mb-3">
    <div class="col-md-6 col-12 text-center text-md-start mb-2 mb-md-0">
      <p-tag icon="pi pi-sitemap" severity="success" value="My Genealogy" [rounded]="true"></p-tag>
    </div>
  </div>

  <!-- Team Badges -->
  <div class="row text-center g-3 d-none d-md-flex mb-3">
    <div class="col-6 col-sm-4 col-md-2">
      <img src="assets/logo.png" alt="Free User" width="50" height="50">
      <h6 class="mt-2">Free User</h6>
    </div>
    <div class="col-6 col-sm-4 col-md-2">
      <img src="assets/logo.png" alt="Subscribed" width="50" height="50">
      <h6 class="mt-2">Subscribed</h6>
    </div>
    <div class="col-6 col-sm-4 col-md-2">
      <img src="assets/logo.png" alt="Default" width="50" height="50">
      <h6 class="mt-2">Default</h6>
    </div>
  </div>

  <!-- Mobile Badges -->
  <!-- <div class="row d-lg-none mb-3">
    <div class="sticky-sidebar d-flex justify-content-around">
      <a class="icon-item text-center">
        <img src="assets/logo.png" alt="Free">
        <span>Free</span>
      </a>
      <a class="icon-item text-center">
        <img src="assets/logo.png" alt="Subscribed">
        <span>Subscribed</span>
      </a>
      <a class="icon-item text-center">
        <img src="assets/logo.png" alt="Default">
        <span>Default</span>
      </a>
    </div>
  </div> -->

  <!-- Search User ID -->
  <div class="mt-3">
    <label class="form-label fw-bold text-primary">Search User ID</label>
    <div class="d-flex flex-wrap gap-2">
      <input type="text" pInputText [(ngModel)]="udata.reg_id" 
             placeholder="Enter User ID" 
             class="flex-grow-1 p-inputtext-sm form-control" />
      <button class="btn btn-sm btn-danger" (click)="mytree1(udata.reg_id)">
        <i class="pi pi-search"></i> Submit
      </button>
    </div>
  </div>

</div>

<!-- Team Stats Table -->
<div class="card shadow-sm p-3 mt-4">
  <label class="form-label fw-bold text-primary">
    {{data2?.main?.reg_id}} ({{data2?.main?.name}})
  </label>
  <div class="table-responsive">
    <table class="table table-bordered align-middle text-center">
      <thead class="table-light">
        <tr>
          <th>Rank</th>
          <th>Left</th>
          <th>Right</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td class="fw-bold text-primary">Team</td>
          <td>{{ data2?.mleft || 0 }}</td>
          <td>{{ data2?.mright || 0 }}</td>
        </tr>
        <tr>
          <td class="fw-bold text-secondary">Level</td>
          <td>{{ data2?.mlevelleft || 0 }}</td>
          <td>{{ data2?.mlevelright || 0 }}</td>
        </tr>
        <tr>
          <td class="fw-bold text-muted">Silver</td>
          <td>{{ data2?.msilverleft || 0 }}</td>
          <td>{{ data2?.msilverright || 0 }}</td>
        </tr>
        <tr>
          <td class="fw-bold text-warning">Gold</td>
          <td>{{ data2?.mgoldleft || 0 }}</td>
          <td>{{ data2?.mgoldright || 0 }}</td>
        </tr>
        <tr>
          <td class="fw-bold text-info">Platinum</td>
          <td>{{ data2?.mplatinumleft || 0 }}</td>
          <td>{{ data2?.mplatinumright || 0 }}</td>
        </tr>
        <tr>
          <td class="fw-bold text-success">Diamond</td>
          <td>{{ data2?.mdiamondleft || 0 }}</td>
          <td>{{ data2?.mdiamondright || 0 }}</td>
        </tr>
        <tr>
          <td class="fw-bold text-danger">Crown</td>
          <td>{{ data2?.mcrownleft || 0 }}</td>
          <td>{{ data2?.mcrownright || 0 }}</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Organization Chart -->
<div class="card flex justify-content-center overflow-x-auto p-2 mt-4">
  <div *ngIf="errorMessage" class="text-center text-danger mb-3">
    {{ errorMessage }}
  </div>

  <div id="orgChartContainer" class="container mt-2">
    <div class="tree-back-btn mb-3 d-flex align-items-center">
      <button (click)="goBack()" class="btn btn-sm btn-primary">
        <i class="pi pi-arrow-left"></i> Back
      </button>
      <i class="fa fa-print mx-5" style="cursor:pointer; font-size:28px; color:#007bff"></i>
      <i class="fa fa-download mx-5 mt-1" style="cursor:pointer; font-size:30px; color:green"></i>
    </div>

    <div id="orgChartToPrint">
      <p-organizationChart [value]="data" styleClass="responsive-org-chart">
        <ng-template let-node pTemplate="person">
          <div class="text-center node-container" style="cursor: pointer;">
            <img
              [src]="node.data.image"
              (click)="handleNodeClick(node.data)"
              class="node-image mb-2 rounded-circle shadow-sm"
              width="80"
              height="80"
              alt="User"
            />
            <div class="font-bold node-name mt-2">
              <span class="text-success" (click)="showNodeModal(node.data)">
                {{ node.data.name }}
              </span>
            </div>
            <div class="node-title">
              <span class="text-primary">{{ node.data.title }}</span>
            </div>
          </div>
        </ng-template>
      </p-organizationChart>
    </div>
  </div>
</div>


 <!-- Remove `fade` and Bootstrap auto behavior -->
<div
  class="modal"
  tabindex="-1"
  *ngIf="isModalVisible"
>
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content shadow-lg border-0 rounded-4">
      <div class="modal-header bg-primary text-white rounded-top-4">
        <h5 class="modal-title fw-bold">Member Details</h5>
        <button type="button" class="btn-close btn-close-white" (click)="hideNodeModal()"></button>
      </div>

      <!-- Loader -->
      <div *ngIf="loading" class="modal-body text-center py-4">
        <div class="spinner-border text-primary" role="status"></div>
        <p class="mt-3 text-muted">Loading data, please wait...</p>
      </div>

      <!-- Modal content -->
      <div *ngIf="!loading && repd" class="modal-body">
        <div class="text-center">
          <img [src]="repd.image || 'assets/default-user.png'" class="rounded-circle border border-3 shadow-sm mb-3" width="100" height="100" />
          <h4 class="fw-bold">{{ repd.name }}</h4>
          <p class="text-muted mb-0">{{ repd.title }}</p>
        </div>

        <div class="table-responsive mt-4">
          <div class="table-responsive mt-4">
  <table class="table table-bordered align-middle text-center">
    <thead class="table-light">
      <tr>
        <th>Rank</th>
        <th>Left</th>
        <th>Right</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td class="fw-bold text-primary">Team</td>
        <td>{{ tdata?.mleft || 0 }}</td>
        <td>{{ tdata?.mright || 0 }}</td>
      </tr>
      <tr>
        <td class="fw-bold text-secondary">Level</td>
        <td>{{ tdata?.mlevelleft || 0 }}</td>
        <td>{{ tdata?.mlevelright || 0 }}</td>
      </tr>
      <tr>
        <td class="fw-bold text-muted">Silver</td>
        <td>{{ tdata?.msilverleft || 0 }}</td>
        <td>{{ tdata?.msilverright || 0 }}</td>
      </tr>
      <tr>
        <td class="fw-bold text-warning">Gold</td>
        <td>{{ tdata?.mgoldleft || 0 }}</td>
        <td>{{ tdata?.mgoldright || 0 }}</td>
      </tr>
      <tr>
        <td class="fw-bold text-info">Platinum</td>
        <td>{{ tdata?.mplatinumleft || 0 }}</td>
        <td>{{ tdata?.mplatinumright || 0 }}</td>
      </tr>
      <tr>
        <td class="fw-bold text-success">Diamond</td>
        <td>{{ tdata?.mdiamondleft || 0 }}</td>
        <td>{{ tdata?.mdiamondright || 0 }}</td>
      </tr>
      <tr>
        <td class="fw-bold text-danger">Crown</td>
        <td>{{ tdata?.mcrownleft || 0 }}</td>
        <td>{{ tdata?.mcrownright || 0 }}</td>
      </tr>
    </tbody>
  </table>
</div>

        </div>
      </div>

      <div class="modal-footer border-0">
        <button type="button" class="btn btn-outline-secondary" (click)="hideNodeModal()">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- Custom backdrop -->
<div *ngIf="isModalVisible" class="modal-backdrop show"></div>


