<app-menu-bar></app-menu-bar>

<div class="page-wrapper bg-wrapper">
  <div class="content">
    <div class="row p-2">
      <div class="col-md-12">
        <app-search-user></app-search-user>
      </div>

      <!-- Filter Buttons -->
      <div class="col-md-12">
        <div class="text-center mb-3 d-flex flex-wrap justify-content-center">
           <button class="btn btn-outline-success m-1" (click)="showSection('today')">Today Users</button>
          <button class="btn btn-outline-primary m-1" (click)="showSection('total')">
            Total Users
          </button>
          <!-- Future filters -->
          <!--
          <button class="btn btn-outline-success m-1" (click)="showSection('today')">Today Users</button>
          <button class="btn btn-outline-info m-1" (click)="showSection('active')">Active Users</button>
          <button class="btn btn-outline-danger m-1" (click)="showSection('inactive')">Inactive Users</button>
          -->
        </div>
      </div>
      <!-- Spinner Loader -->
<div class="text-center my-4" *ngIf="isLoading">
  <div class="spinner-border text-success" role="status">
    <span class="visually-hidden">Loading...</span>
  </div>
  <p class="mt-2 text-success fw-bold">Loading data, please wait...</p>
</div>


      <!-- Total Users Section -->
      <div class="table-responsive" *ngIf="!isLoading">
        <div class="col-md-12">
          <div class="buy-form" *ngIf="TotalUsers">
            <h4 class="page-title text-success">Total Users</h4>

            <!-- Rows Per Page Dropdown -->
            <div class="d-flex justify-content-end mb-2">
              <label class="me-2 fw-semibold">Rows per page:</label>
              <select class="form-select w-auto"
                      [ngModel]="rowsPerPage"
                      (ngModelChange)="onChangeRowsPerPage($event)">
                <option *ngFor="let opt of rowsOptions" [value]="opt">{{ opt }}</option>
              </select>
            </div>

            <!-- User Table -->
           

<table class="table table-striped custom-table mb-0">
  <thead>
    <tr>
      <th>S.No</th>
      <th>Name</th>
      <th>User ID</th>
      <th>Wallet</th>
      <th>Credit</th>
      <th>Debit</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let item of data; let i = index">
      <td>{{ (currentPage - 1) * rowsPerPage + i + 1 }}</td>
      <td>{{ item.name }}</td>
      <td>{{ item.reg_id }} <br><small>{{ item.password }}</small></td>
      <td>{{ item.wallet_amount | currency:'USD':'symbol':'1.0-2' }}</td>
      <td>{{ item.credit | currency:'USD':'symbol':'1.0-2' }}</td>
      <td>{{ item.debit | currency:'USD':'symbol':'1.0-2' }}</td>
          <td>
        <button class="btn btn-sm btn-primary me-1" (click)="openEditModal(item.reg_id)">Edit</button>

        <button *ngIf="item.status === 1" class="btn btn-sm btn-danger" (click)="block(item.reg_id)">
          Block
        </button>
        <button *ngIf="item.status === 0" class="btn btn-sm btn-success" (click)="unblock(item.reg_id)">
          Unblock
        </button>
      </td>
    </tr>
    <tr *ngIf="data.length === 0">
  <td colspan="7" class="text-center text-muted">No users found</td>
</tr>
  </tbody>
</table>


            <!-- Pagination -->
           <nav *ngIf="totalPages > 1" class="mt-3">
  <ul class="pagination justify-content-center flex-wrap">
    
    <!-- Previous -->
    <li class="page-item" [class.disabled]="currentPage === 1">
      <a class="page-link" (click)="goToPage(currentPage - 1)">Previous</a>
    </li>

    <!-- Page Numbers -->
    <li class="page-item" 
        *ngFor="let page of getPaginationGroup()" 
        [class.active]="currentPage === page">
      <a class="page-link" (click)="goToPage(page)">{{ page }}</a>
    </li>

    <!-- Next -->
    <li class="page-item" [class.disabled]="currentPage === totalPages">
      <a class="page-link" (click)="goToPage(currentPage + 1)">Next</a>
    </li>
  </ul>

  <!-- Group Navigation -->
  <div class="text-center mt-2">
    <button class="btn btn-sm btn-outline-primary m-1" (click)="goToPrevGroup()" [disabled]="currentPage <= 10">
      « Prev 10
    </button>
    <button class="btn btn-sm btn-outline-primary m-1" (click)="goToNextGroup()" [disabled]="currentPage > totalPages - 10">
      Next 10 »
    </button>
  </div>
</nav>



          </div>
        </div>
      </div>

      <!-- Conditional User Components -->
      <div *ngIf="TodayUsers" class="p-2"><app-today-users></app-today-users></div>
      <div *ngIf="Activeusers" class="p-2"><app-active-users></app-active-users></div>
      <div *ngIf="Inactiveusers" class="p-2"><app-inactive-users></app-inactive-users></div>
    </div>
  </div>
</div>

<!-- Edit User Modal -->
<div class="modal fade show d-block"
     *ngIf="isEditModalOpen"
     style="background: rgba(0,0,0,0.5);">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <form [formGroup]="form" (ngSubmit)="submitUpdate()">
        <div class="modal-header">
          <h5 class="modal-title">Edit User Profile</h5>
          <button type="button" class="close" (click)="closeModal()">
            <span>&times;</span>
          </button>
        </div>

        <div class="row p-2">
          <div class="col-md-6 mb-3">
            <label>Name</label>
            <input formControlName="name" class="form-control" type="text">
          </div>
          <div class="col-md-6 mb-3">
            <label>Phone</label>
            <input formControlName="contact" class="form-control" type="text">
          </div>
          <div class="col-md-6 mb-3">
            <label>Email</label>
            <input formControlName="email" class="form-control" type="email">
          </div>
          <div class="col-md-6 mb-3">
            <label>Password</label>
            <input formControlName="password" class="form-control" type="text">
          </div>
          <div class="col-md-6 mb-3">
            <label>Wallet Address</label>
            <input formControlName="aadhar" class="form-control" type="text">
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="closeModal()">Close</button>
          <button type="submit" class="btn btn-primary">Update</button>
        </div>
      </form>
    </div>
  </div>
</div>


 <!-- <table class="table table-striped custom-table mb-0">
  <thead>
    <tr>
      <th>S.No</th>
      <th>Name</th>
      <th>User ID</th>
      <th>Wallet</th>
      <th>Credit</th>
      <th>Debit</th>
      <th>Level</th>
      <th>Level Pair</th>
      <th>Level Amount</th>
      <th>Silver Pair</th>
       <th>Silver Amount</th>
      <th>Gold Pair</th>
      <th>Gold Amount</th>
      <th>Platinum Pair</th>
      <th>Platinum Amount</th>
      <th>Diamond Pair</th>
      <th>Diamonf Amount</th>
      <th>Crown Pair</th>
      <th>Crown Amount</th>
      <th class="text-success">Total Amount</th>
      <th class="text-danger">Difference Amount</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let item of data; let i = index">
      <td>{{ (currentPage - 1) * rowsPerPage + i + 1 }}</td>
      <td>{{ item.name }}</td>
      <td>{{ item.reg_id }} <br><small>{{ item.password }}</small></td>
      <td>{{ item.wallet_amount | currency:'INR':'symbol':'1.0-0' }}</td>
      <td>{{ item.credit | currency:'INR':'symbol':'1.0-0' }}</td>
      <td>{{ item.debit | currency:'INR':'symbol':'1.0-0' }}</td>

      <td>{{ getGdataByRegId(item.reg_id)?.leftlevel }} - {{ getGdataByRegId(item.reg_id)?.levelright }}</td>
      <td> {{ getGdataByRegId(item.reg_id)?.levelpair }} </td>
           <td> {{ getGdataByRegId(item.reg_id)?.levelpair * 1000 | currency:'INR':'symbol':'1.0-0' }} </td>
      <td>{{ getGdataByRegId(item.reg_id)?.silverpair }}</td>
           <td> {{ getGdataByRegId(item.reg_id)?.silverpair * 1000 | currency:'INR':'symbol':'1.0-0'}} </td>
      <td>{{ getGdataByRegId(item.reg_id)?.goldpair }}</td>
           <td> {{ getGdataByRegId(item.reg_id)?.goldpair * 2000 | currency:'INR':'symbol':'1.0-0'}} </td>
      <td>{{ getGdataByRegId(item.reg_id)?.platinumpair }}</td>
           <td> {{ getGdataByRegId(item.reg_id)?.platinumpair * 4000 | currency:'INR':'symbol':'1.0-0'}} </td>
      <td>{{ getGdataByRegId(item.reg_id)?.diamondpair }}</td>
           <td> {{ getGdataByRegId(item.reg_id)?.diamondpair * 8000 | currency:'INR':'symbol':'1.0-0'}} </td>
      <td>{{ getGdataByRegId(item.reg_id)?.crownpair }}</td>
           <td> {{ getGdataByRegId(item.reg_id)?.crownpair * 16000 | currency:'INR':'symbol':'1.0-0'}} </td>
    <td class="fw-bold text-success">
        {{
          (getGdataByRegId(item.reg_id)?.levelpair * 1000 || 0) +
          (getGdataByRegId(item.reg_id)?.silverpair * 1000 || 0) +
          (getGdataByRegId(item.reg_id)?.goldpair * 2000 || 0) +
          (getGdataByRegId(item.reg_id)?.platinumpair * 4000 || 0) +
          (getGdataByRegId(item.reg_id)?.diamondpair * 8000 || 0) +
          (getGdataByRegId(item.reg_id)?.crownpair * 16000 || 0)
          | currency:'INR':'symbol':'1.0-0'
        }}
      </td>
      <td class="fw-bold text-primary">
  {{
    (item.credit || 0) -
    (
      (getGdataByRegId(item.reg_id)?.levelpair * 1000 || 0) +
      (getGdataByRegId(item.reg_id)?.silverpair * 1000 || 0) +
      (getGdataByRegId(item.reg_id)?.goldpair * 2000 || 0) +
      (getGdataByRegId(item.reg_id)?.platinumpair * 4000 || 0) +
      (getGdataByRegId(item.reg_id)?.diamondpair * 8000 || 0) +
      (getGdataByRegId(item.reg_id)?.crownpair * 16000 || 0)
    )
    | currency:'INR':'symbol':'1.0-0'
  }}
</td>
    </tr>
  </tbody>
</table> -->